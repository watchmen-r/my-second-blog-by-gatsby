{"componentChunkName":"component---src-pages-blog-post-tsx","path":"/009_http-request-keep-alive/","result":{"data":{"site":{"siteMetadata":{"title":"Oda's web memo"}},"markdownRemark":{"id":"0baf1dfe-55be-5803-b9ec-eb93f7bec6f3","excerpt":"Recently, I was confused about http request which took for a long time. Even though the target backend output log which means returned a response, client could…","html":"<p>Recently, I was confused about http request which took for a long time. Even though the target backend output log which means returned a response, client could not receive it.<br>\nSeems the connection would be interrupted at TCP level if the target backend had not returned response for a while.</p>\n<p><a href=\"https://milestone-of-se.nesuke.com/nw-basic/as-nw-engineer/keepalive-tcp-http/\">The mechanism of TCP keep-alive / http keep-alive</a></p>\n<h1>e.g. NAT gateway in AWS</h1>\n<p>As for the NAT Gateway in AWS, the connection will be interrupted if a request remains idle for more than 350 seconds.\n<a href=\"https://repost.aws/ja/knowledge-center/vpc-troubleshoot-nat-gateway-connection\">trouble shooting</a></p>\n<h4>P.S. NLB</h4>\n<p>Looks like NLB in aws also had <strong>TCP idle timeout</strong> and it might be able to be changed by setting.<br>\n<a href=\"https://aws.amazon.com/jp/blogs/news/introducing-nlb-tcp-configurable-idle-timeout/\">Introducing TCP idle timeout</a></p>\n<h1>How to set keep alive in axios</h1>\n<p>I think there are some method to set keep-alive explicitly. In this blog, let's take axios library which is in Javascript/Typescript as an example.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a custom HTTPS agent with keep-alive enabled.</span>\n<span class=\"token keyword\">const</span> agent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">https</span><span class=\"token punctuation\">.</span><span class=\"token function\">Agent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  keepAlive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  keepAliveMsecs<span class=\"token operator\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Send keep-alive probes every 30 seconds.</span>\n  timeout<span class=\"token operator\">:</span> <span class=\"token number\">600000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Setting idle-socket timeout. Default socket timeout would be 2 minutes.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Configure Axios to use the custom agent and set a timeout.</span>\naxios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://example.com'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  httpsAgent<span class=\"token operator\">:</span> agent<span class=\"token punctuation\">,</span>\n  timeout<span class=\"token operator\">:</span> <span class=\"token number\">600000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Set request timeout to 10 minutes (adjust as needed).</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>error <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Error process</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"About keep-alive","date":"May 06, 2025","description":"I just found an issue with HTTP requests when a request takes a long time, it gets interrupted even though I set a timeout in the HTTP client library (like Axios). I want to document the solution and explain what ‘keep-alive’ is."}},"previous":{"fields":{"slug":"/008_webrtc-basic-knowledge/"},"frontmatter":{"title":"WebRTC summary"}},"next":{"fields":{"slug":"/010_guideline_of_evaluation-points/"},"frontmatter":{"title":"The guideline of evaluation points"}}},"pageContext":{"id":"0baf1dfe-55be-5803-b9ec-eb93f7bec6f3","previousPostId":"135463c9-015a-5e67-a009-2541d66692b3","nextPostId":"318b99a4-b3d3-5406-a93e-dc7921760fd6"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}